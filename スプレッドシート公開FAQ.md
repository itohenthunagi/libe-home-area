# スプレッドシート公開に関するFAQ

## Q1. スプレッドシートに誰でもアクセスできるのか？

### 回答：URLを知っている人のみアクセス可能（基本的に検索されない）

---

## 📋 詳細説明

### アクセス方法

現在の公開設定では、以下の方法でのみアクセス可能です：

#### ✅ アクセスできる方法
1. **CSV公開URL を直接入力**
   ```
   https://docs.google.com/spreadsheets/d/e/2PACX-1vS...（長いURL）
   ```
   このURLを知っている人だけがアクセス可能

2. **あなたのWebサイト経由**
   ```
   https://itohenthunagi.github.io/libekoumu_test/
   ```
   サイトが自動的にCSVを読み込む（ユーザーは気づかない）

3. **GitHubのソースコード経由**
   ```
   https://github.com/itohenthunagi/libekoumu_test
   ```
   コードを見れば CSV_URL が分かる

#### ❌ アクセスできない方法（通常）

1. **Google検索**
   - ❌ 「ウェブに公開（CSV形式）」は検索エンジンにインデックスされにくい
   - ❌ 元のスプレッドシートURLは表示されない
   - ❌ CSVデータは検索結果に出ない（可能性は極めて低い）

2. **Googleドライブ共有**
   - ❌ 共有設定を「制限付き」にしていれば、ドライブ内で勝手に見られない
   - ❌ 「誰でも閲覧可能」にしない限り、ドライブからは見られない

3. **スプレッドシート一覧**
   - ❌ あなたのGoogleドライブ内にあるが、他人のドライブには表示されない

---

## 🔒 セキュリティモデル

### 現在の公開形態：「URLを知っている人のみ」

```
【公開レベル】
レベル1: 完全非公開（自分のみ）
レベル2: 特定の人と共有（メールアドレス指定）
レベル3: URLを知っている人のみ ← 現在ココ ★
レベル4: Googleアカウントがあれば誰でも
レベル5: 検索エンジンに完全公開
```

### セキュリティの実態

**「URLを知っている人のみ」= 実質的に公開**

理由：
- ✅ GitHubにCSV URLが記載されている（誰でも見られる）
- ✅ Webサイトのソースコードで確認できる（F12で表示）
- ✅ URLは長く複雑だが、完全にシークレットではない

**つまり**：
- 意図的に探せば見つかる
- ただし、偶然に発見されることはほぼない
- 検索エンジンには載らない（ほぼ確実）

---

## Q2. スプレッドシートの編集権限について

### 回答：編集権限を適切に設定すれば、勝手に編集されることはない

---

## 🔐 編集権限の仕組み

### 重要な2つの概念

#### 1. **スプレッドシート本体の編集権限**（ドライブ共有設定）
#### 2. **CSV公開の閲覧権限**（ウェブに公開）

**この2つは別物です！**

---

## 📊 権限マトリックス

| 設定 | スプレッドシート編集 | CSV閲覧 | 推奨 |
|------|---------------------|---------|------|
| 編集権限：制限付き（自分のみ） | ✅ 自分のみ | ✅ URLを知る人のみ | ⭐ 推奨 |
| 編集権限：特定のユーザー | ✅ 指定したユーザーのみ | ✅ URLを知る人のみ | ✅ OK |
| 編集権限：リンクを知っている全員 | ❌ 誰でも編集可能 | ✅ URLを知る人のみ | ⚠️ 危険 |
| 編集権限：一般公開 | ❌ 誰でも編集可能 | ✅ URLを知る人のみ | 🚫 絶対NG |

---

## ✅ 推奨設定

### スプレッドシート本体（Googleドライブ）

**共有設定を「制限付き」にする**

#### 設定手順：
1. スプレッドシートを開く
2. 右上の「共有」ボタンをクリック
3. 「一般的なアクセス」で **「制限付き」** を選択
4. これで **あなたのみが編集可能** になります

```
┌─────────────────────────────────┐
│ 一般的なアクセス                  │
│ ● 制限付き                       │ ← これを選択
│   指定したユーザーのみがアクセス    │
│                                 │
│ ○ リンクを知っている全員          │ ← ダメ
│ ○ すべてのユーザー               │ ← 絶対ダメ
└─────────────────────────────────┘
```

### CSV公開（ウェブに公開）

**そのまま「ウェブに公開」を維持**

- これは **閲覧のみ** の設定
- 編集はできない
- データを読み取るだけ

---

## 🛡️ セキュリティ保証

### 以下の場合、勝手に編集されることは**絶対にありません**

✅ スプレッドシート共有設定：「制限付き」
✅ CSV公開：「ウェブに公開（CSV）」

**理由**：
- CSV公開は **読み取り専用**
- スプレッドシート本体の編集権限とは無関係
- 編集するには元のスプレッドシートにアクセスする必要がある
- 元のスプレッドシートは「制限付き」なので、あなたしかアクセスできない

---

## Q3. スプレッドシートを変更した場合の運用

### 回答：何もする必要なし！自動的に反映されます

---

## 🔄 更新の流れ

### 自動反映の仕組み

```
1. スプレッドシート「まとめ」を編集
   ↓
2. 「公開_まとめ」シートに自動転記（ARRAYFORMULA）
   ↓
3. Google側で自動的にCSVを更新（数分）
   ↓
4. ユーザーがWebサイトを開く
   ↓
5. 最新のCSVデータが自動取得される
```

### 📝 運用手順

#### 通常の更新（データ追加・修正）

**手順**：
1. スプレッドシート「まとめ」シートを編集
2. 保存（自動保存）
3. **以上！何もしなくてOK**

**反映タイミング**：
- Google側のキャッシュ更新：**1〜5分程度**
- ユーザー側のブラウザキャッシュ：**ページリロードで即反映**

#### ユーザー側の確認方法

**更新が反映されているか確認したい場合**：
1. ブラウザで https://itohenthunagi.github.io/libekoumu_test/ を開く
2. **Ctrl + F5**（ハードリロード）でキャッシュクリア
3. 検索して最新データが表示されるか確認

---

## ⚠️ 注意点

### CSV公開URLは変わらない

- スプレッドシートを編集しても、CSV公開URLは変わりません
- 同じURLで常に最新データが取得できます

### 再公開は不要

以下の場合は **再公開不要**：
- ✅ データの追加・削除
- ✅ セルの値を変更
- ✅ 行の追加・削除
- ✅ 列の追加・削除（D列以降）

以下の場合は **再公開が必要**：
- ⚠️ シート名を変更した場合（「公開_まとめ」→別名）
- ⚠️ スプレッドシート全体を新しいファイルにコピーした場合
- ⚠️ 「ウェブに公開」を一度停止して、再度公開した場合

---

## 🔍 更新確認方法

### 方法1: CSV URLを直接確認

1. ブラウザで以下のURLを開く：
   ```
   https://docs.google.com/spreadsheets/d/e/2PACX-1vSkGeGpXlosW_k2NKZBuhnhI_y3qex4Oi8HZRx5IyFC8RBRKWpwy7C3ZeXgWtjnQw5Vc-iDU-W6YeUa/pub?gid=0&single=true&output=csv
   ```
2. CSVデータが表示される
3. 最新のデータが含まれているか確認

### 方法2: Webサイトで確認

1. https://itohenthunagi.github.io/libekoumu_test/ を開く
2. Ctrl + F5（キャッシュクリア）
3. 検索して最新データが表示されるか確認

---

## 📋 運用チェックリスト

### 日常の更新作業

- [ ] スプレッドシート「まとめ」を編集
- [ ] 保存（自動保存）
- [ ] 数分待つ
- [ ] Webサイトで確認（Ctrl + F5）

### 月次確認（推奨）

- [ ] 公開CSVに機密情報が含まれていないか確認
- [ ] Webサイトが正常に動作しているか確認
- [ ] スプレッドシートの編集権限が「制限付き」になっているか確認

---

## 🆘 トラブルシューティング

### 問題：更新が反映されない

**原因1: Google側のキャッシュ**
- 対処：5〜10分待ってから再確認

**原因2: ブラウザのキャッシュ**
- 対処：Ctrl + F5（ハードリロード）

**原因3: ARRAYFORMULA が機能していない**
- 対処：「公開_まとめ」シートの数式を確認

### 問題：CSVが取得できない

**原因1: 「ウェブに公開」が停止された**
- 対処：再度「ウェブに公開」を実行

**原因2: シート名が変更された**
- 対処：正しいシートを選択して再公開

**原因3: スプレッドシートが削除された**
- 対処：スプレッドシートを復元

---

## 📊 まとめ

| 質問 | 回答 |
|------|------|
| 誰でもアクセスできる？ | URLを知っている人のみ（検索では見つからない） |
| 勝手に編集される？ | 共有設定を「制限付き」にすれば絶対に編集されない |
| 更新時に何かする？ | 何もしなくてOK（自動反映） |

---

## ✅ 推奨設定サマリー

### スプレッドシート本体
- **共有設定**: 制限付き（あなたのみ）
- **編集権限**: あなたのみ

### CSV公開
- **公開方法**: ウェブに公開（CSV形式）
- **公開シート**: 「公開_まとめ」のみ
- **閲覧**: URLを知っている人のみ（読み取り専用）

### 更新運用
- **通常更新**: スプレッドシートを編集するだけ（自動反映）
- **反映時間**: 1〜5分程度
- **再公開**: 不要

---

**この設定なら安心して運用できます！**
